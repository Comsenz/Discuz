<?php

/**
 * Discuz & Tencent Cloud
 * This is NOT a freeware, use is subject to license terms
 */

namespace App\Install\Controller;

use App\Settings\SettingsRepository;
use Discuz\Web\Controller\AbstractWebController;
use Illuminate\Contracts\Routing\UrlGenerator;
use Illuminate\View\Factory;
use Psr\Http\Message\ServerRequestInterface;

class IndexController extends AbstractWebController
{
    public function render(ServerRequestInterface $request, Factory $view)
    {
        $url = $this->app->make(UrlGenerator::class);

        $viewPath = 'install.problems';
        $problems = $this->preRequireSite();
        if (!$problems->count()) {
            $viewPath = 'install.install';
        }

        $data = [
            'title' => 'Discuz Q 安装程序',
            'problems' => $problems,
            'logo' => 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAABkCAYAAAAVKjACAAAgAElEQVR4nO2dCZgcVbXH/1XVMz1bMiF7QvaFPaBhCxAwgARkj8j2Hgoi+EAFnwrCe4grmyi8PBBFwQfuiCxGXADZAsgmsgcCWUgISciemcza3VX3fbfqNJlMdXVX3TrVU5Pc3/eVwVvT1VXdXfW/59yzQKPRaDQajUaj0Wg0Go1Go9FoNBqNRqPRaDQajUaj0Wg0Go1Go9FoNBqNRqPRaDQajUaj0Wg0Go1Go9FoNNsZhv5CNRqNpp9y8h3AUecA63qdftcGINsFtAmgow3otIHZw4Fl3cC7nUCdfPpngEw90NEKmMJ7ne0AQ3cCcjmgpQVoHAIIB9jSAswaCixsH4mW/G4Q2ANC7AMYoyDEMAByGwRAHsimf9vhiHWozy6H46xE3n4BrfZCHN70KrY0AIsANBeA2gLwwRbAMoHNAvjYIKDbBl5uA2wTmJYBPjEBuMsAzgMwvsxXZahJWsY3otFoNJodF6MoKAbgOAaEMxMZ43C80nokup2PIC8GwiSpg1NefCxzMjo6Z7h/I4Wu0QDe7HgLovAYrOw8mDWPIWPZvtdVGS2EGo1Go+mBAQgxDYZ1OnJtpwGYClNaa3kgYwAmCZ+Byk5FIQDLov8GUGMALWJ3GJ27I9P1RbTWLEWndTcs8zbAWErqWnW0EGp2NIYAyAKop3/lbLQTQCuAzfrXoNlhkVZbxpyDza0XwHFmexpXFCYDqDXjfzIOgFp5YBLHXH4SuvKXo8a6BML5JWzcgDrrTdcd61RPFLUQarZX5N22D4ADAewNYDKAsQBGkgjW97juAoBNAFYBWA3gJQCvAniaxjSadJJrB+LokyFfLG8V5xQIXAohDoST90SxnMuTC2lpum5WkQHEuajDOVjVfi2czLeQtWx0VedTT1oIpVk9yzfKSzeALQA6ALwHYCmAZQA+SPh9SzENwIUlxqMif4E3A3gz4HUX0MM9zdwEYGGVz28ggGMAnAjgMBK+MGRosX8Yiecx9JocgGcBzANwL/2+OOD8/uTv/hsyPMK3pzxXAhhV9i/CsxLA1RH+fiqAr/hG04OcJD0H4KcVzmg6vPCNuEgpuBHAO5GP0zTWm8apYncfBMO5DkLeL2SBmQyWnxIG0AQT77RfgUzmU6gzv4xu86FqvHPSQngJgP19o8kj3VxvA3gUwFMAHiIXWNIczySEkjt8I1uZwvg+SSEtq+9V6b0OBnAOgBPI4uOiFsDHaJMP+rsB/ATA8zGPL4812DeqhnQ2XRbxlU0AvusbVeftiEL4fwBm+kbTxb0hzuZkxvvwFt9IJUYfAOx/ItBS4e9641p7YgAKuevhdF7wYWBMGpC/5jpLRqruirzzIBzrMtRY16PB8PYlRNLS3+gbqQ4DSYAvB/AXeIG61wDYPeF3H+0bUWM9gNfLvPJ/fCPp46NVOCM58XgEwD8AnM8sgr2RVsLZZCncGcOaamaegP5JYZI32TcSjz9HePWh/UAErwp5TZwW9Vu+0Uqcdo+XBpGr8HfoEagig11sMRsFewEc54KtrtGUUXTNWvnvY3P377FObLuYwUySQihnvBN9o32DPI//IlejtLR2TegspvpG1FhKARxBrKSHf5rZf+uKODvyQfo3AA8AOLIPPoOz6cGlYg1MpIkaF4sUjsMthFFcejf7RtLFCnIbh4Hzfo/m4NzjTGC3scCGkE9xKYDtAujMXQsn/xAcjK3KGmBcGizg/dxpuHPpQzCdxEyrJIVwAhLVcGWkC+0NAN9M4Nhcwr/UN+Lnj76RdDEGwG7MZ7QTgNvI3X2Mb291kZbdjwHcD29eHhbuyeES30hluIUwzO9VchKtwaaZs0Oem8H4XUb7DmsHACffKNPVQ2YbGEC92YgXN/0Nq7ouR53Zf0qpuJZsLdC2ZTaWvPsoNhc8F2nQpkiSa4Rcs6UkkNf9HVpTOo8iBOMyMkJwRiXerrAfJIQ/8I2mCxmxuYDpjE4ha4LLHcXFyfT7OTmke4vbG7HYN1KZXRjf34nwIP9f30i6+AOAx0Oe0TjGpZBoQTKzrgamjvSmH5V8Lp6LcTfYzgMo2FNg9cdiYgIYUA90dx6Bmxfeh+Zhn8ROIz7cxUGSFiH3rDMJ9gPwIs1U4zKe0QIO83BbzCgySXEA03FvBXBPCkWwiBSWFyhquBJTKuyPiopFyHkOa0JG055ToThWXyNX2j4f4RwmMBoS4d3bI6cDsy/yYuIriaCs5CLs/WDbL7jfuXSP9teimjIxP5sBNtlzsKrrSqxxgNW0fdBjUyRJIeS+4ZMiQ9ZV3OgvzusN+3C7zzeSLmbEPBvpXn0GwH/49qSPJlq3reQJ4Zwgysjc932j5ckwu2eXhAjWkY/s632j6eILEQsqcN7vYV3LwPE/BgZQ0kw5ZDWXztwBaG9/GoZ8xXZQVlpaf01ZoKbju2hfciS6lwG5d4HuHpsiSQphml2jpfgxzVpV4XI35SMIYdrXCfei3DwV9qXE9oP69hIiMYDWLwcFvMhIYMIUNYtsZ5pgcBHGe/G1GL+DavAygJ9HfB+u+7099P0+9iBg7wPLW4MmTXVyuX2xofVJCJHtF0ExUSnkfwOnYELYgNNjUyQpIZRf0yTfaPq5I0YQBtcDTkatrfWNlualSLPJ6mMpukePoFy9ND88gxhRZoIymlmEVL778WUeoypUeojL5YJv+UbTxZkKZ8Nl2S9H2EzAj9/ofXNBHkD5NO/YAKx7byzaNs2HYWb7Ljk+QVxhN0fAEXN9QTOKJPUpjU84pytJ5imuRXHdGFHD4ef5RtJFVPfosVQIIanUi2ogE/BvL/E+3MsFYYKqesMZKIMQv9dvyyB432h6+IHi51jd+73xEGDcDK9Wk8wyXldik09zu70GW9Y+BmE3wtyOK2i6VeHERXDEVM9nKmJFziT1SU2sQrJ+UtRSEv70CMfPMD7kos7y56W8XFUUi/BA+uy3B0qlOXMHkKnkEHIvWZRzjQ6j6lJpZQ0V3YhKA+PnGM4t+t3ve3fHpjJP1he3AFsKD6CmboqXKN83nRyqiiGuhmWc5gbTxCApIewvgTJByKooF0VI/p1AXQ04iPpwe5JcqcN9e9LBAdTlobvC2ewSIXQ9zaymlJy/ljhH7vtCJTqAU4w7qK5vEN8v89hOA2crOtQmMVbNKjeR8DhuNvDVQ3zDPp5d+U1syh2NwdkdRATdyzwVjrErDPPtNFqE/S1QphQyyu238Go3VILz4RJVCAWVgzrXtycdDKIk6hfKnI20wh9LaQGGKNxDBbWDfjOcbskOxRxCzt/qsjLXKieHn/WNpocHqAaxCtW934cc71W5XVsiS0XKeL0FtDsfxQZ8B801O4YIFnEtQfPLsLJfiHPdSc3WtgchrItQfaZvQqm3cr9vJF0cWOFs7qFoxv6KvAO/BODUMsIA5gCy5Qr9E+uZz6HcbzXNyfMyvPBzvtHwcN7v5a36oaOBI071/CmZYf6teRiwOmPgqfXzUBBePdEdCRk449hnwu6qga3esykpIeyPEaOluIBC4ivBNdNfTw+4qDxCHTfSymfKnNelVOGnv/JPAB8J0T1gIFlJXKhYg1OqVOf0VGqFlVa+QqEmqnBN9FdVzAPdYw7QPBLY3OYlyvTe8gaQt6/BwMxYVwQT7NCQXsQgOPZJyJValg9HEq7RAduRENZSMvcPfXu2hWuGuJzyiqIip0IPA/gU03kUeZDEOS5BzW0n9YNE63LMjRCoNJ5qpXKhUlGGu85pkBBK6/4uhRzHntgk2nN8e+KxgKHwN5cQvltx7XzggcATOaB1hW+Xi2OMRca+HA21iBsw0m+R+YM1dXMwaMQ9qpeQhBBOZgqXXlfmZs9SXc+hvj38fCaEEHI9YFRm+UXuT0AI/0C945Li9wkeO0nW0AQpSuoK9+RQ1SLkJOj+nOsbUeMG5vOFYs5gT8yqFdseOh2YeCzQvRGwei+fG56j2+74GRxzxxXBIkLMjFM8Jykh5OA66tocxGC6sY+hHzd3p4Mi0+jYQd3WhzK6vIJm2GF4kKrS1DCdC8jaSUoIP0u1XpPmSeoy/yq5obppojaegniOjNgt/n4SwaiutWrn75WCu+B3+Qd5PI4G8FXmY/6oQp/PMIxiLK5fvtj2zBOBo4fAratp9FrFklm2izfuj5WtxyDLecv3Q6wMYOfHoWWlvI9fU7mANAthpZtsI0UivkDdti8m8Uwi8vC4MkLI2W4qjkW4kRLROdsT7VVhEqBKpsIkJy4y2+qnAH4R8twPpTJglYqvXxzDrZaGYtuc0Y7rKqROxMGg5secyPvjPxmON7FqxbaP2hvYRQAT8r5d7if03pbvocvw/GM7MtIadrts1MxIkxByzXyjBo3cRM1aZXmrPXx747FvmVdzRsjGnWH/MYE+fScmIIRfK1OPMy6yX+E3IpSpA9UHldtpVBGmd4DUy5Qb+JLvleHhFKEPFIptm8zu2cUKnfHD8sMEKlOdy3S+1YkQH7AzsGA68PIKIL/Ftxsm9kCtcTQG1Wi3KEgMTUP5WZxE1CiHMLQrWkeLKIG7fEhydMpVmeG6MURMi1DyJ99IfE5mPl59hA7gUcjTGunnI4pgT+4md23P4J6b6fuPI4JIIOS+fJCFn5HUQ4+L4Id4PHZJwCX6EGMpQq6Jb67s/T52OjB2PDAoDwyv33Yb0QDUZ/7bNQu1CPbAUJ7ocQthhmm9TN5kbb7RcEgRnR2vBKuPiVRMuRRcM/33aKYfh9W0HsbJQcyFos9mrMpRpIPO817fnujIdZuPU5/KT5M7NC6jmD9DFc/BJOb6reXdeur8jvl4grnYBNeE5t2yeaDjDwJqhLfibzlbt4wDmPYgQJyxXXaVUMXNJ3SUtYdbCMcwJUbHdREupg70XNSWKcTNdWNwBR4EdT6IA2ee35d8I/EoUJHrfzEeU3aa3x/Ar3171JjMLELlgyxKw71GqXIOlTivgvdFhcvKpO+okHwMRKYWGH048ME6oEWmTuS33VryZ8CBtT20GGRGOUeWWwgnMN3wwS6D8FwLoIRzXZlSaxZWFYODwpKEEH7SN6LGTAB7Mp/b8WS9pZkdKXVClWaK6uTkbeouwUWW8bsM/g4H7wLsNBnItQOGte0mH9mGeaYWwZLUlRoMA7cQcvnPg38k4ckz56mVqjAzvozLNCpcrqZ3GELEezOLKRn8DN9IPH4So15kNeFOnVBZn+MUws4EIkZvA3/846d9I/GYzFgUIfgZN3amVzpNqp2V3bpl6uS/I9ycuR2pnmh4mlRfmFYh5BKFB30j6pRac5xEgcwccLqauHsUZqhPYFw4jlFkM1M4fDXgFMK84v3BKYTvxQhIKsXhVJaNk9up/B0nnJV5gu93kQNs4f3rxkTRJroAJ3cUhGsW+l6mUYdbCDnchA5j1Cdn2H+pX171iu9GI4ki3HGjR6czP0iuD+j5l0Y4XaPLKCcuCvXMdU65o7K5cwZbE1iLBvP9HmxRjzkYyEvhc2QAyNZNuNthvr/XFFGut5xGIaxciDY8GxRrd5aiVLg6lwW8mfnh8pJi8e5yHB2zdN4s34g6BXKL9gcaE8jfi8okxn6ZYI4YvYo5rQOUQlPqfo0Ll2W/JvD+bBgKDDsAaO8CCtltt3wWcMwDYGi3aADKz3rOhPoGJiFcRu4fDvKMx1rjG+ETwmXMgT0gq5DTdTiA0lJUg3E4owEfKRt6ni7G7UDFtqMiz+sK5nN7IsEatpzFtkv3DGqWuYPjgLb3/TmChjkIhjW1tHNKkWJVltI4tB7cSc9RQUUJbNpn0mb1+Leetozv2PL/S6vW5Ayg3uYDavENhYRTCKfEWazsAedss5HpnJyANRGumX4SNRvnJbCGdlIMIYxSz7MST1TYnya4ozX7en0QjL/XX/lG4nNOAscELY0kX2y7fjDQbAE1Yzx3aBEpM/ncJLRvaPDVHQ2LcK+iAAPrIaTnzVgOK7MSjtMCOGsBcy0srIWBzciLHEzRCRgkhKIAGJ5/VsCBYdgwYHrrlbDcfw1XCOsAUQ8bdWgaUId8rgm5/AgYznBkMiNgZAah0LUzDHMqhIzEF8N9gql0bbKyjFmic3E4OIWQSxSCF5GjM5rpGteVyEUaxJg6kURy8nyyYrmiWkH5hIZCC+xhzAWf3/CNpJc0CCF3sW2OqG4Z0XmIbzQe3wh0OcZnBEWJcxD8jJt6NNDQBHSslyXDto5LuTEc9d+SYayGYZwDUyyCaaxAzim4x7dkibbc1jtaCpLJ5HqVx7apE5cUKvn/axqAfKd3bVamDnZhPExjXzj2L+Ol3rmPpbd9wyHhFMK05dOBGqZysKBEYMbEOHkrveB4sPRG/pr/wlxVQ64zHUYiG4XhVJSAi1Ju6rTCLYQqa8mca5QbGcRGempu9Y3GQ6aUXM18zJ5MZOzsEvyMy3UBGwrAphI1AAxzEoya6PNQ4UrMItTgYRR6WV6lSrSVGFLCDe7pcTD5347d8026YIi3YRhtsfPPDXdTfo5yBstwzTqDfyTR4SpA/YpvhLfYdhJCiATSKKDYKDWoKo8q/SVaFMxCuFZRhDgLfi9mCES5lalnaU/O9o3wwvk9Bj/jch1AxgLMWv9mZJqVVEqKhC3a0O4AeQEUhJee4QTEwieN66LNkIXoNu45vaQgR7lA+XrbVvYUcQohxw+lu+yPJBrNjHlrpfKRuB4uIsECxn+PUbM1iEqtikrB6Z5FArVKk4RThJZR4EIUhjOnTsT9rUp36Fm+0XjIUnhPMx+zN1xCWAic+Mq1v6ZRQCFHbYV8m3q8gwHh+v/cJ76sYWp4YmhXMwLV8dyuRsGLvSm0AwWZGymOjbVGKGzAsj5A405KLZjA6Bo1GYttK0f+9OKLTK6MHEUp9obrxni/xPojF53UmoozWXkCdWiIUtaMu3PohASKiyfBCOZi26UfoOXhrnMadz37F76ReMjf+IXMxywFV/6edG2v941KMvXAuEOBjg2lXZbe5D46rQVgl4Z6fKrXfHRhJ/CXVqBWJG8ZukWx64C8tHSlYSutOFkXID8YovOwWDaZGyiT+QdqBxR8+0LCJYSjmXKBuKxB6Xa53DeqxlMBP1wu1+iSBPu6gdIouKt2nBxRCEve1TE4OIEuBUkwmblsWHCQRTBpKrb9TWYLWXJBAl6PUnDlNpexqCk7QQaSlBYmoXQnNVrAxsJw3L9u23QJ2wEaHLIKk7QMqcO+La3AvPffxbcT+Cy8hU91ZDqG7TyIjer2BJdrlKvYNpcQ3hpQG1SFUq19LMZQ6jI3Bgt/Y8ylLHKib6Q8pW9rdVTWKfsC7vw9ld8Kt/Co3qNjmTvCgLwCv/SNJsOnaVJxDj1f3lJ8l/KfnyPIWiq5qeUaZwygy5mAJR2DsbQTWNLubculWzJP7soSwS2qyGNJwcvb3iZ9ajm5PtkGFNqAfKu3CXk5XRezPB5M8WfX3asIl0XIVXGBI3XiTMZiu/Ir/I1v1LN+uQJAlEN+QyITzx+nZHguptF3Hvb7Ui59FMDO1E3+7tK7UwN3xRSV+4NTCGXljjd9o+HgdokigbXGSiyhrXgt06gR+BHkpQizPBT8HRY6ZS1RmQ8XpA2dSoabG5wimjCgbhoymfmu2PZGWomFYp58BA+jIGtSvr7b9tyd0tU6ZAgwarinMKJXxlXR/Fqy4ly0tY9DJrYMPQbb+SDgMwsFlxByuV/irj/IMmC/9Y2qc1fAQ3wi47pLUg1Oe/JHZiEEuUev942Whsut1JP/AXBPQDF0VaZRc+R1TMfjFEL5JFnhG63MRxnP4R3FNfzTqbA2J1dXwZtSiddp+zk9S+Xv51AqJ7gfWcG9CZ74DhgD1DQD3Z0kSj1xxWaTK5IqOAXAGvBx1A2c70aOlhIN6cSXQizXKN1IzAq+HC+J3XN1yjDHcQMAqxtY1AUMaQJG5oHV8njOtr5HLz8yC9u+Xrk4QE9M8zZXiEvoe1i4hJAjT0mULURbmdnM3SYkN/pGPNJabDuIBwD8OGCfKnMiCGGpqjxxGU2THq7WTkeTG3kJPcQ4graG+UbUEQou7inM/R9Vmh/L/NGf+kbjsYKS59OENKNepu0mkpX9SBRnkNUoYxdWBp7zyGnAuEnAFrmW1yswWopH3l7s1iBVibCUqQpd7WdA5K/03K+99sv/n814CfDSqjPpPQWlWZgZT/BAxb/lCzJSUOuA2gaguwsY1ehd9Vt5YGObdMcCH7R5ERAZmrJKN22nDWzK34K62iFuqoiqO9YygLbCRnQ795YV7BCkyTW6JoYQfg3AD32j8fgzgFcDjsDlCm5LMIewJ9Iie4bcN1zMoIjIMNZesZA6ZwQlyNKQCd5f8O0Jj0FrV1fSK6ZQ0fJZihZYT7gKLoAcSpMjWqvf9o3E41GFV9+iHO0YTNI5gxxIG+kftIGKUexd1opd+QLQusaLHs31rh8toy6d4NeGobNrCsYNPwK77vTYNkk4gqYr63LAW+/JfDwvAMXsGcZHlh96uEOlEDnFeqUC6C54Iin/O2OSmzTr/U0NXYN7zMIJyBqf+1BoVZHne+SQudiveesEUdEfyBEsw9Xi5V2FGa9M4r8vARGUXOob2QrXusu7VYp4Q0LJ9Sf4RkqTCyhKwMGF5AlQmZycQud1Za9x6eF4HsAevldEg7vRbJQ6mp8A8O++UXUErTVHYV8A5zGeg+QPCueRBjbQeQd3SJh2NlAzDtjUCrTb225bClJal8I0u/zmXEgsC9iw6TqsbwVaNgEbN3pbawuwaQvw/hogJ12oRcHreVjRY0OJ/SWQQietz7XdwIYc0JoH1nRPQkvh966IxkEKaNZwsGXQj7C0EVhCmyIcQjiJqbr+C76RYGTptLlUczKJCMJfV+hlyCWE1bAGi/R1j8KXfCN8HE1l8OSEaP8KR5XrOJeRtX9PmWLgo8gVONO3JzzKeU0B/EfI+pxHkUeDk8cVStuVCjSLg5xQnc98zErUUOcU7ko4fvY8FbC6gLosUFfn37LZjTCMV5TXwrI1QEvn/nj23X/HYhtYWQO8nwHeXA88s1Tu8/6GG+nKtdyUkGY4Yj4M13iKgeEVJB+SmYv3123C35cCj9CmCIdrlCtEXIryXr5RjyZyWe1FLqsDfX/BRxvlJgXRlNK6qpVYRJONAyr8XRTkdzE4ZKPYhyiPLCky5CL/GgUkvEauzRx5LcaRhRelFGAd5ZEeT3Vbo9KRwLU+Qq7BUhGzzXT9vS1cDqJ2irg0gWLfn2EsuBGWoTQhWutGJ3opG/PLLJuo8ZFzgcHTgfeD5sYf5v/NR40xw7c7DG7ha+nitG5Dbf1jqG9Y7R7Tbt9a2q1URGlc3KVFYxRs+wl3eSRutoSsJGNmOjBo/DeQtbx8yJhwCCFXYvlFtPU1ny/rvvAsYK7ZYdCvvpYe3pz5f/IX/jCzENaSCy7MzP+ZhNYJS7Er80P4zyQ+UXPWNvlG4lNH/fa+QpOLZfR7PJgsweEJvGcXWc9hGRkhkCosz5L4c1pmA0hYS/cG9Cj+XodTYFYxOGshlV58nMq7xYv+bmwC9pIWWj0JXoBa5J35WN15mZuSEPAnZXGts0w9Wt57BJvFR1DbmEdNxnObclMMuDHE3ijYD0BgHEtGsSvoxhXosDvRUQj+rCLAIYRcgSNp4A8hKpZw5mUF5RTVU1g2V1GAIklUsPlkBBeYLE7wZd9o/+AXZP3OjXC2SVr8M2irBj+LuJZ9h28kPpMptYWri4lBObb7VBDCoOfbbrQVc5YXkPfgCaq6FO27f+VWoGkOcMosINcW/HBvLTyGX3VthC0Gx0kgh8AeEM58GMZRMM129soybjsnd43wLDjiTliGFXRJkZDBOFbtQmSb5rqtqpjgEELuyhV9hbRW/q2K11suXaSFtlJ5SGljNlkp5R4mRW7tx0IIyl2U6+Hf8u0pTTVd30lyQ4Rjn8TY9aUnSVi6N4ZwtYZNDduTtgtobfglcqE+S5Gj5VOI2nPAKccCF1GaYSGotrrRDcv4HUy3lrI6rtVpHgQ7/0/k7dNhWK/HOl4x57DYQ9F0xuCV9uvRWThzm76KcXEjXMUZyNpADV/PCI4jbS9C+ImQwQ1BM8SorKyQevBX30g6aSKXXBgWUq5ef+abEXIyo9RjTSsyBzBs5+8MJZf3B1YD+G6I81S53zO0BHEpRbW/F85r0gks/ivQWEbzXbExeT5jmQ5R6N4dXR2vwTD/ywsMUvK3bk2sFxgGx74CuZa3sDF3Jng8lx5yKbA2cy3q8CpEG2C0+zdF4gohZ9fmvuS4CF3PuZLpl1VYA4wSRdvXRIkeTVsitAoXhnQHL61S5aCksCnCNiw3Ur5cf+CSkOfIcb9nKZWkMt0bgPqsV//Tgn9zu8eLl2HgeRZvpuEGz8iGudegUFgAYX8RBlnflQTMKL5eXmHhECzedBMWtC9Ck3kVhGhC1uRt9CfEs6i1/htGLSACNkXiuka5W7z0BedHsL4sxt5uQYEyRfqTEB5Hn02YNciXKOjhNN+e/sW/UUTh+RUsJhlt+p++0f7BxRGiNKelJNgtDG+HTL3OMt7vj/lGStG6wqvS4lpXAUrnCpT5dcCZ79unjJuSMBUGfgTDuA4Cj8MxHoVw4xgWUWR4F6WTDHQ/F9sYD7vrMOQ7D4Sd3xsdwrOtsgZf4UOvqbC0NNsxsPZEV1zlDIDT3coghNwtXqqNjBC9PcJ77sxYPzIoUKbICqpwv7tvT/oYQf3awiY6X0hBNlyVjfqK2SRyXy3z/r/op0L4VMSyfJw1fpMmrGCPpwhYDoJrjPbkvX8A+XYSwoB5pac3TwJ4DoIxYKpYuk3I5Q5xAgriBLIKBZx8GxwjDwiLIndr3No5bnYSWYbFFETO6r8S2cHCsY6BZXrRMXZArdQYcFiE/ZXPKORGcbWbQshk+hf6iRCCgiTCCqGcXX5W4fNPG9KTcG2Fc3qF8tDCucbSQWfEHpZfLJMDnDbkPbQxfCUAAAhUSURBVPX3kOfE2dk/XOCULG3mdnK3qKZnAK5b0joPTuGNWN3dy7H1sIYXwe5s6y/1LNMyB4iJFPwNBeDYkWfhsKan3TqllS610t0YQNyr4MohrCYyNvlYxYcw5/WGKYPwjG8kvZwU8cx+3Y8CK0pxH7mEw9T+DLselRZmR6giM5SKTPcXorhvOVPDwpU9WfMasOpFL2DGNII3KX4ZYwFM4/uJJMGXJOk29r2QEwEn8xWM3+k3mFgHjM0CYypsisQVwv7mGn2V2tKoRi5yXW9XBIuwvzBBoeXPeZSM3N+4ieqUhuWJ0GtEfU/U7+T2ZM0CVv4W8Z7imvi2hBZC+fBf/RQwtMFba6szy2wW0Fh7OSzz7cD1xP6KFHfLugQ15lwvaT5Z4vyAuYptV4ubqWZgnPqenMW2wwQhyNwevqzR5FGp+zqLWtf0F85VzIU8M0SZ4r7mCxGt9GMUPAF9SdS1Wo72ciC3aJg8W4/Vr3iZubLaTENt8FZfAwyql2L4CeTkQtr2IoZCdq34EsyaG6ol8HGEcAJzv7WkeIdcoRczLONyzRDDirHdz6zCT/pGKmNToM1z1T7ZiLxFBb1Vq6asjZhmUm0+B+AnEd7TTKiCTFL8TqHDP5cHKFphhbceBF5/Ehg0xKtVYQRscp/IApmGd1HffJwrGv3ZMiyev2WdgVrrlmpeSxwh5Cq2nRRywf8K6i7AkcRdz3jNUcqk/9M3kl72VKzxKddtD0px5OEPqRRX3AT5P1GN0DSxnprG/l/Ec7qOMaKyGkRdpx3EeL9HrDAkgA9WAA0ZQAwN3uTybGEwUD8CGDH+ITQ0nw8n73VmqPZ6XhxE0RVqroKZmeHW0q2yoMcRwrTWGJUux/+lOoDXUINMDiYzNhiNMjNNu6XUmziuMtk/7+sJBGCr8gy1Pbq0QvGDKMyltJ008EeK9oza32/3Cv0608bN1Bw6ClMY+0lGtUSBl37mlf4PE6NebBVYn70ddY1nu4E05SJO04YjnULGPFg102CYz/eFVRtHCNMWKLOQLMBdaC2gXJKzCpwWcJRqIy8yink1iLtm9ANKNWBMFo7MyyTKhyQUuXsb9VBc7ttTHZbTWucchR6DUOjC0ZfkFdtSca0PQikuYfmTwMtPeHV6wuiC/Jt8N9A8+JcYMvQM5LrzbnuipFIruNjiANOGfR17NZ+MlvxG38XK/5tJ/hriCCF3rzEVllAh5yNolnpNxeK26uzGeKygYtulWB+h/FsaOJihWPgrFERzVpWv/V+0Vja9Cm7ah6kayy2+Pckh69t+m/oyqq7vyebA+/lG08tVij0MuZ5vTsT7fSuv3rE1ST0MgopeW+bvkc3ui7rsQtjJR1yqI2RErECLcwM2dgN1JHhGr1xFO3kLMY7UynUd9d740ciRwK2khqsLyGJ4PaHWQqW4VzEYpDcd1MEg59sTzE8qNAtOG/Jh+x3GczqdRPF43574rKZ+g3dT09u+YG9aO5zD6H7vyVNU4ea3tHauipxsvtlHn5EKLRTQp+LW/isV4o/LBuqcEd1XmakHLnwNGD+lfBMsg0SwfSVQ3wDkcl73ivr6eqxZPxem+fnUWobSFGsvHAoYT6O+2Bi4WOFGeJ9aYwZoCHn+16rFM8b5dI6owoqsDDluJdFd1ccuwukkYHFpUQi6GEmBKP2FDWTVcSOt8hMAHEqRpiqi0U35pM+TVfZ4hUbM1WQEuZaPJrfsCMX3Xk9ry09TrVMuq3oyrSmWeyyniWUxWmHtxzQp2UT1ddU47T7gsDnlk6h6C2E+B3S3Aw0NwPoWaSUeCeH8QCHPN3mk2NXWnImMdVdJF7AUyk47/JP/59UXQo2mLxlIk4PdKJVnEnkoBlAtxDxZ3xvIk7Cc1mZfS9B9zkkdXd8+JIhTaSJWR62vHBKkLrrGRVTl5nVK9ejQv87tgE8/DOx/lFeUMIiyQrjZ6z7vBqCIcyBk/ITYZ2sDwT4mlwdGD7sEwwbcEMlHFsQlTQE7ytPfix5rdlxaqenps9vpJ9BFa5b/8u3RaJQQd8K07gRwBhznLEAcBYFaGH0oirU1wIaW0djY6ouTqSZaCDUajWaHQaqNdRcM8y4YYgwM+3g45gkQzqGuN0VajtVcT5Tv5YgxboeJPjRQtRBqNBrNDsWHFuD7MHErROZWID8MMA+GhVlw7MPhSPcpCZVN/f+SECqZ4pGxdkZzQ59WINRCqNFoNDsqrva4/7MOhjkPljkP3TmgecBeEM5MtHUchYx1KIQYlsiyone8EX1dGk4LoUaj0Wg8QXRTFhy5dvcGhPMGupxbccigRqzqmoFVuY/BwpEADvyw5o0oNslVVEjX4nSGo6V9aF82GNBCqNFoNJqtuOt2DvUDlKXbzHbUmI/CxKMw8E2Y5mTYOBiGcyQMcxaEGB/LWjQwEEZmhBZCjUaj0aQPKW4FgV7Nf5fAMJZAOL9Cw2Ag3zkDhdxhEPg4IA7+sNCKQ4E3FQVS/p0UQmtBX60TaiHUaDQajRpS6EzzORh4DgLXw8qMghAHwbFnodY6ArazZ0Vtc4uE58Yg33dpHFoINRqNRqPGNj0QXSGTJQvvg2Pch2EDgE1d+6CrMBMozAaMmQAGu38qXa+GudXibLTGYEic0tfx0EKo0Wg0Gn7cRH3zVXcTzi2oqW+GcGbAzn8MtTVHwnH2Q7djYl03MHvY3jhscPxTuMo3EgothBqNRqPh58PUjKLFaLYA4iEYeAjNA4HNW6ZiJ+sQjMzOwatt7VjUpb8EjUaj0Wg0Go1Go9FoNBqNRqPRaDQajUaj0Wg0Go1Go9FoNBqNRqPRaDQajUaj0Wg0Go1Go9FoNBqNRqPRcADg/wEK7a6R+Nj0KQAAAABJRU5ErkJggg=='
        ];

        return $view->make($viewPath)->with($data);
    }

    private function preRequireSite()
    {
        $problems = collect();
        $defaultPhpVersion = '7.2.0';
        $phpversion = version_compare(PHP_VERSION, $defaultPhpVersion, '>=');
        if (!$phpversion) {
            $problems->push(['message' => 'PHP 版本必须大于'.$defaultPhpVersion]);
        }

        $extension = collect([
            'dom',
            'gd',
            'json',
            'mbstring',
            'openssl',
            'pdo_mysql',
            'fileinfo'
        ])->reject(function ($extension) {
            return extension_loaded($extension);
        })->map(function ($extension) {
            return [
                'message' => "PHP扩展 '$extension' 未安装.",
            ];
        });

        $problems = $problems->merge($extension);

        $storageDirWritable = is_writable(base_path('storage'));
        $cacheDirWritable = is_writable(storage_path('cache'));
        $configDirWritable = is_writable($this->app->configPath());

        if (!$storageDirWritable) {
            $problems->push(['message' => 'storage 目录不可写']);
        }

        if (!$cacheDirWritable) {
            $problems->push(['message' => 'storage/cache 目录不可写']);
        }

        if (!$configDirWritable) {
            $problems->push(['message' => 'config 目录不可写']);
        }

        if ($this->app->isInstall()) {
            $url = $this->app->make(UrlGenerator::class);
            $setting = $this->app->make(SettingsRepository::class);
            $problems->push(['message' => '您已安装过站点，请直接访问 <a href="'.$url->to('/').'">'.$setting->get('site_name').'</a>']);
        }

        return $problems;
    }
}
