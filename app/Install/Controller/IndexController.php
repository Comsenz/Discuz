<?php

/**
 * Copyright (C) 2020 Tencent Cloud.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

namespace App\Install\Controller;

use App\Settings\SettingsRepository;
use Discuz\Web\Controller\AbstractWebController;
use Illuminate\Contracts\Routing\UrlGenerator;
use Illuminate\View\Factory;
use Psr\Http\Message\ServerRequestInterface;

class IndexController extends AbstractWebController
{
    public function render(ServerRequestInterface $request, Factory $view)
    {
        $url = $this->app->make(UrlGenerator::class);

        $viewPath = 'install.problems';
        $problems = $this->preRequireSite();
        if (!$problems->count()) {
            $viewPath = 'install.install';
        }

        $data = [
            'title' => 'Discuz! Q 安装程序',
            'problems' => $problems,
            'logo' => 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeoAAABkCAYAAABJoHMmAAAgAElEQVR4nO2dCZQU1dXHb/UyCzMMMCwDsg7KroioERFFJW5oJIlb1EQxGuMSP5e4BBM1q1Fj1CRK4oaKW4xKNFFEw4egcYtxwQVEkVVWWXSYYZi1v/Pg39DTU9Vd9e6tpf3e75w6J5Hp6lfVVe++d5f/JYPBYDAYDAaDwWAwGAwGg8FgMBgMBoPBYDAYDAaDwWAwGAwGg8FgMBgMBoPBYDAYDAaDwWAwGAwGg8FgMBgMBoPBYCDL3AKDwWAwfEXoTkTdiKiSiHoSUR/8/45EVEpEMSJqJqJaIvqCiNYS0Qoi2khEn+P/N0XtVhhDbTAYDIZCpTMRjSGifYhoGBENJaJqGGcvKOP8KRF9REQfEtGbRPQSEW02T4bBYDAYDN5QxvlbRPQoDGsdEaWEj21EtIiI7ieiQ4mo2PxGBoPB8P+TuPndXZEgooOI6PdEtNoHw5zvUDvsyXCtB47fru+vE9EPiKg1gAuzEHtQLoxGIqpBzOEzIlpCRAvw36JCPyK6jojK8IB4vdaPiejnAdzbtDtpNxydiKiEiJL47kasPr/EC7SKiJbifgfxu/tFGa57IBH1JqIqIqpAnCuO30A9a1vhHltDRMvxuywWHtNxRPRdjeeEMNZHiOgp/25VG9TO4xdENEDzuVbv6LWIFdqh3Jo/wXOocz+igoXjViJ6nTGmq4lopOa9biCi3+CZjSrq+T2FiL5DRBMjsLB5g4juIaJ7C/z5a8NNIax8sg9lvDdh8nyOiC4nohGYcMNkAvO6nvZpoVUJw6BcPu/DADV4GFc9Ea0jooVE9BgRnQlDFwv5fudDGeH9iehnRPQ8EX1CRBuwEHF77XVYqMwnor/gPlYKjO0+5rNyrr+3rg2VWMDojlUt8nrlOP/ECMwpUsc8IurCuNcxvJ+649mMuTCKFMG9/Srm8Kj9drOJaL+I3jtPKFfFExF+SV4moguIaHBI9+dc5vivFByLMvgHE9Et2MlI32tlwB4moklEVC44bi4q1nUEEf0OCzk/njO1aPkjFmZJzfG+zPj+TXAZBsUo5v16PM99+mGE5xQvxzJ41Tj0Rvay7hjmRex9TDOeiGYWwG9Yg3lY972OBJXYkUX9Zi/BRF0d8E27jTnu44TGcQwR/d3jrplzvAg3bpgVB2qCm8I0gF6PZkw+J3ocaye4JnW/Vy1Aevh0H+34HvM+3ZDn/LcUwJyS72jEbpHLkUzvxUMBPhduUJ6UPyGcVEi/56N5vECRpj9il4Vys1dj8i4L4KYqb8O/GGNV7uW9mWMYhF1uGC9FC65/f6H76Rb1TN4cUjJK+lCT9Cwi2tflmPdFroXu970R8D3mhrtyuemLC2Snle+4ReheX8ocxy+FxiHBt3z0agVxvIacloJjfIHe8H8H4CosY8aWFqCQX5cfwiUb9r3eisShTj7f775I3NsQoedMXfs1EGLIxSnMXdP9Pt/bbGYxxlqLUIQTlXAZR+U31DleY8alM7mHMQ7l4Tld8ofXpCsR3V7gv2n6WIjEvoLiRwV8wzdi/H6xBzKidcc3E5nXXlEvxd0RvN8vCngInDgj4iEYZdh2zzH+q5nnvyLASaMIk5XuWJfh3XBiYEQTi9weKqb5NcH7PYcxli9C8GhlMwqiIoX6e9odH0U4Qc+Wu74CN/12TD7SfIs5rjs0xtOX+WL7faxH7LqD0L1Wk/qTzAVRUIeKQY91uA7uwupoofvphiFMT9F/ERZy4tgCn0/+R/BeV0FBS3csK1HpEBbHo0KikH9Pp+M1yJcWBK9/RW76Iz7Era9hjukyj9+ndmzvFsC9rsUqm8up0O8tpOdso821l6MMRPecTcwQiVeOR/6E7nhn5Pm+KQX2m2YejwuXhI5hhnKCzl3I5LwCy1/SOZ6U3OT5VdtaJlB6EBVORU1srpW+V/ZkfLYRmepuGYCsRL9cy1KoBLOfwnWqSwkEJKbDg1BIvIWJN5Pu8AzoshILgKAYpBmSSfNhnn/nvDdhshz6DfWCY+jHjHW/LzgWL0yBp/KrLsn5beESWl8YDaWqr9IK6VahhY0qS3qbMQ7lWtzL5XepFfyzBXBvVWnY2cz7ulsBZwQ/4ZBUth8zJvvPgJWcpjLvw8l5zj+/AH/bZugHSHMlc1ySbni3/KoAfz/OUYOk6shyWoEnfdgdTZBD5dKXmbm6wEMcNwrKcPkO5e4+h3lPR2BHWojP1Ywcmd8nMM+dryZZEiX68Azz/RqWYzw9Qi6r0z2kSrEysQRygA4L7MnYMd5fFOj7yT3mSoROJd25mQxlruRv96hNHMfusRLut5EoserMGEM26l7diNg7x220B1NWcjVKe/JxlEYsOx/ph5YytIo5qJ30+UT0IOMcoxEPGiB8rUHwGBZ/Wxy+i5s9ms+VLEkV6tR12QwXsRNDXJSyRY03oMcvTUfMc7qkWzoGxWXIy/GbWuTivIfw4GdQRWyCjahAzsYe8FaNDEBVbDw2rndH8QF9lLEKUZP34czvj6MU6SS4Q2sEV0gvMhc45zC//zYX39EFGbTca10BI3gx6lv3wUO+B0o7lFD+H/ByeK31rcMDzGH/AJPGmvFsSnmKHs4zSahF0N8Y52+BLGxQjGa+Z/PyhJbOKZAM/vTxBRK+/KAvM7t+YQDaBWnO8vk+L4IW/kTkdLhN4CpBnP98zOmSNiL7WBpyhr0tZczauC99SEQ7HDKZUjf+fMZYfsv8bjex3IuY36F2eNfnqe/NJIlF0eMuz78Zf89hLx+VjLahGcBd2An8APHTb0KA5Fy48h5EKMLr+ae7CF8kUZOpew0rsQsNCm7p1O15xnmzT7+1X8clPt73fZhjfjIgferDfTSAKszyfUHxGDXWv/oYsv2x0DjFGAK3g+4FLfVJBzqJH1ZCnWoB9KK9EmN6G1IuBBMq4ELUPf9arE51iKG1aa6FWi0yIjn0Zwpr2B3NcFX+CBNhV5fj6wvN5Wku5VjvcZnxWsWUd31ZOPSTj8uY9/+8POd/DF6CZh+PBqFd+5M+d4s7hTm+3/g4tjSD0IFO8h1NYfd7FLO6IBdH+5S0+I7gokKEw5k1cs/4PL4DmTuV9HGxxnd3gzHQ/c46F/Ftjmu9Hk06uKjQwIU2bmm1k/4G89wdkaAh9QLVo2Xo4QI5GyMyDIrdd93pYQI/LMd53BxBN1yYxvwdDs1x7hhc60eiC5kfx1iUB3LqwFOI/XLix264njnGM30eXxIVB1LvaAoJuOcEVMXQFaEpyfE3Izk0MpzJvKDrA7iQYQLG+gONuMMQZoOFt1zsxl5hnF86Q3UYdhcptFvU3amnUYb0z4Ivz78ExmTH6TaqS1M9LgS44Ytf+3BdThQzF6BqATc8wPHaUcp8d1KCXbHywTGC2wRygPLxU8F3VB0P5ZGW9YOkD1Uz9/qYwO2ZXzMv5jsBjXM/yFZyxup1d3gw8/um5wkLjMKkp3PuLT6pWBXBrSmxUz+bucvMvNYrfe7Fu1+GxOOfNGKCdzKuryWAXVMmnZmxyP8G3IrTjj8KPFe3BjRWTmjxU59zF8bC88e9lyksKlSHsNy76FgpWYnOVNT3J1S23xvUYZ/2h/rvxf2v3f536nDp2LKE26p+Br2H0EmiLlT3QlqFJCTdMhmrYN3xPunx+7gZ31flOf8ljHP7HXLgshdjEZJ5qNKNcQGNeR8sCHRyLuYxrnFzDu1wPxjN/E3+FvJO40Rmh7IUPApBZFL3ZYpJveTjArVcsMf7BiRvOmPFKdH1GCrb70OqGN9EHcenqOIw50P9e8eDm6jisCYq3fNJIstVgnhCOBFZS3tfOuGhjNmTcy1cpEHxqMd67WwO8pB0RAISiB/5eP53GJ/1mzLsVrjJUbPgBfl3QON+J8N95oVKlJro8iUafQSFW6U8J5YhhhcGuyOjnLNQ+BxKX18GMP4RzESqVUjo9INzhBbBy7F4yjk3lwx9hDqMnkmxsuGUSiW2v2WpFudj+1toJSjVkqBkj29Th71mULJ3XoG2ZuQjLRa6XxN0NMClDXU5M5HiY+wGgqIBzdPdCIjY0dWDwk+MaUi34iVzQhmzasb5axif9Zvv4wHn8ARKrHKJakSF3ZF4qMt6G91wP+Eaai/a9ZIkYaQ5Qi2EksugmlwMZzZ78EvopLeQtvVaeDrnOv1BUZ9LqPyAD6io58mUatBYBquPNBMluh1LpUP/QEV9ryIrmfN1WyGY8zFOZ8Mhbaj3YK5MP/FxtefEB6if0yGBLHI3FDOVppZjAnZCPWm9GOcPMuTghWqBnsr/xMvvpAAWNQYy1esWBHw9nAVoXcAqWZlclNe9mp+/Bxibpjwyq/loZTa9ycWVzPmH8Cw4GulY+f5U3O8qKhl0K1mlI3bskhkoY62O4t1voPIDV1GiyxG5TjYdbn0ug3Xi1NKGeiTz85/qrY/Y3IWHWAe3cql9PbrJs1GrunU5/r0T0116vI9KShwuY3bCeg078rrwL8U1A5hlKB8EONYSZhLiJkG3ohfGQLSGw2IkOwVFjCmVW+sifKbDUKHkRbUgf97uH+KdDqGyfV6g4sE37DDQurN1Nqkd57ISRVRcnbPgKCVUFVOis7CNmqFeKjQOr3yA0gwdervMWN2T6W1YBle9E6VMLeRyrBr3Y5xDmhHMrlqrkHEepBtYAreKcE7MD3Cs1czd/8YQwhFdsQvmJFW1YBcZ5NiVCE5Pxue3+mSoLxJIpLsTpZftiFeMow4jnyUr3plSjY6f74Lw2M3YkS/Cxk95EJ4jop/kKgFUO+tYxQgq6jeFKOYYWZgtsAgu1mldK22oOS6wMF7YNHVQvNGhyqXLZ0+m4lq+OF6RQI/XQXATnx+RBghXMprtN6MH8HvCY/KbcmYP6mYf3Zt2cJvMLBXcH7nl5wLeo9vg9g6S/szynhU+eJaGC9SOv4cWmO2IdzyQOox6gSheTin7p6QX3vNXYUh/jEYYg/EeDUWm9W/Rk+Bex/BBqpRKBl1PsRLHdXItM/mY4CnzLJEtaag7aspqplmHXWNYpBtLeKWLy+QAziKmEfH7XLTg4NIT4hwzIacZlsHei1l7/TdG7kGYVDLFHZYHlH2cZiBzgRikm54gX8vR6lf8B0moQdOHKUPpx6L1eGZsWpnf6+wSZZW7u8OoZ8mKlTot5b6Jfvu/c1ltlJaRfhYypG1B1nhx/5w/7esC86znEKWkoea2oVuPjL+wWKLpIi12cd0WM7b0hQtD3QD5QynGQahDiXbcgf/P2Tl55WRGzF2Vy0wJcKySVDKb0iyAUERQcHb/FLDHoxoub078vwbyuGFUSQxgeuWk77Wa977HPMdTdrtUK9mVSkfOJIp3sdtJx5Ff8Bi0CryinoNHUF7blhRRovsJZBU7voKfouENB892UtpQc2I+YZVopPkME7wO+dyz/ZnlNl+6yIzd7NNCRyVyXYCMxxch6D/R5512dzQe0OUPcPMVIrszJ+MFmp4hHYqYJYEpZm93L5TCSHMWQWon9TMoqQWNJaAoJm2oxzKlX+ucyp6SVWeQlSiz20knEXa4llmmVgnPYVsZ6JRKLLOoZPA0p8+tEJhb8nXOa4ekoR5cQJmqdmxilO/kk4esZhrqFS52y2sCCB2oZMGr0cRC6WTfSER7+/A9Yxj1+J+i/WShwq1JDjI+3Z1pqDfk0QaQRCUVTmKe7x9EdHdA482mDHOsLtt8yAE6nfn5GU6Lh6L+1znV/0xBSE6CkRBpaY9z1tpW5FNx8FzZJGmoOZmqzXCxhkmK4TrOd+MHMnegbnYdauxvM77DCyp7/QAke72CrMpJgm3cTmN8dkYB76aJaahbA07I7Mp0fS/IU8kgxQECghXLoT4WZFghk47MGupPhd31FR7EnuxohPu5TbzXSnShkmEPUyxZbrebPg47aUnOzN5oqQzwZPcJlOx1rtPXcO+jZxU+KUPdkVlL2RgBQ02MJIF8Ly83jufWPfhsCPXCZciqfAoJaJPx33ThTAC1KDErVCymof4s4DyP3XTceBl8EICbvjtyLDjjrIeM5GeC4/JKd6ZOwkfChvpwZiOVd+xKYhPdvklFfU6jVGs752x3LLak21z2sy1JjReRFXfcW3EXa56TPaUMdS+mDN86uG7DRvchyLUTjweYcPMKshLDQrms70OZhG7JxiGMMMF7EQihcOjBzKBdEfB7xNnhUUAKaqrl4r7Mc/wFbu8w4bYB/VhYT/1gZox4jn2osdUpw/s0n8JsnWzDbCmVAu64huTaTc+ucylD3ZNZ3/d+CLWU2ViaYvdb8qxUOzPDAnUehGBasOqUKNPiMAba2ndouPwPZSyYZvh3SYGwJ7PhwsqAS7O48fR8lQxcTsBOmMMbKB8KQzExE66YlKT6WzHzt2+GXkMbYsV9qGTQVDv72Ekgu9wJKztkZyWImtbPpsY1dzp9RlfbgfAcrfb6ISlD3Ze5ugoq8zMXlZpx5E15VkjcutgFHmPncwPWHnYihmzxGRCFcfsZzgTgKORfIAxnqtcFqeyXEBA4yiWJy2WAwHvwJRKXoqARz3kvGoTzNvoz57R1dpnzqZZ6ophthGKEgFckF+03iWq10GqbPmExu/g16OSRSBlqTmtLioihrtKsE16XJy7Yg5lktVAjye1aAQUdKb6OLGw3cetejFyH1SHHECXgGL7WgFtbdmCWCy3zMZ4eQ4keRyNecU1IpVh2cMIMqwVqfzPpzSxze9suN6Fk8J1OhYl+9o9vtW+t7Fgh2ZlZwdOgI+MqYajjzPhJKiRR/mz6ayZrrM7TQ1sijufV7VYPV9FjzO+W4gjUX+d73voxYrQLCqg7lh0WM0RSC33joBjETBpcLlDm4sSlUMzi8LiT9nQI9Gcu9tcKL2L7MZO6bLXoYx0dVV39iE2ncaNRkUlvZuL0Rh3Pl4ShLmUa6nyGLiiGaMYH802O3Die7i6pFqUH10TEgJ2D3XUuejLcSitDLJ2RoJuHEIEdW3xquODEXszJerlPuRQHCqjSqd3+VcLJVxyGMRdFq4WrQThub3LUe2jd6vT3nGz3fKyy9ehajqZxIDMf6+2wsr47Mn+4xT6urN0S05Sia3LRMJ5jqLfoJB5k0IDksvGoWQyiZtWJMsSsc+lCd2Oocq2PQEIihwFMQ70WUrNBwV2A+uFFq0ACI6edLKFeOqxOfnYMZeqpS4ZEYky3N2mEPKSbR2XyfPtFTIpSzY57m32Z43klLEM9lJkAI12Ir0NP1AV65Qt0bXGiiOn6lqqLfQcqQirW81CIgiDH5bkf3NhPIdOfaWCCLkvjSkdKx9Nj6JCks+DO5Pd2Gckhw8kFSAlrVCSYrTYJ3j4v+NWmVoUI72rzX6wdgifbFn3X7u9LIZ+sSwqGOhRlMm7ZQNga34SCd524w/w8mavVzD6tK4XrYv+L2LUSKLmEiGYFqAtNcJUenePfOeptYZekcenPfB+DTMjswHT/uWky45UT0BmJg9IguF54XFwSTI2KrcL16glm1jM5er4sx/2eX41bpmYvGJXHu3HlTUStthKiKvt8NOP7FurKPEsYaq4LLAouprM0P5evbncE02W1Eqpt0ixEVuyJSNS4AAIEQdTg5vJccOoTo9A/mwM37hd0FyrO7n+zsFdHxQ1vYdagfwGXdxTyZTKpYrYPrhfOXYgxmy+RU7w91eS4cZ7D/D473sMz03YMLXXUtOZup03vWUybOVfXOyBhqEcwPrsxAjtq5VY6UuNzddiR5mJP5j32WxCiDkZbZbdOwKLrQqgw+eUeH57jnnC6RnXzOZblJ+WMJiSEpKcgS7MGMsMUHwsKiKS7KXEycQmiJm8KjUmSPsxr+1S4/W2Mufkgp2dn24ITnJ6K96F2KEUNhHDa5P9YxUQNK/5Ardtsk8B3w8ZGF/WOztN97rkTWydmAsyGCBjqCzV1gP/pouSBE8drCnjyJezgp6LBxkTstHPF4HUobddabhccN/xApp5zmHRmdkZaGnCexwDmZC0ZT1cT7jeY53gSz30U2Y1ZmuWHp4W7yHKQVLaclup1EK9xTAv3gMoSOztbHMmKE7XWLqfmDU84nek8prb5Yo4gE9dQD2HGYDcgWzcs1I73ZI3vTkEiM5dhSTAFF2oCLrfJ5kPstI9B/E8qISWWw8XtNckkkxE5FgBRpxNz17RYeNeUD25fZKkubwcLdFNahC5wUSnFyqaa6WmSNtStAomb9nXRqRZKNdduN5o2zESiH4fPkFTb1hpbRC31K2jr2+OptfYdu9MPRqkrh9kcW8c11IOZhjroHWMm6tov0vQIvOkibtKXuQLzWojvFzWIxR+GnQeXVI56582Mc3dlKnuFSR/mZLwuwKz3StQq69KEKgQunRFj5OQmNMFIRyGh1Y6YQDMO6WqAFgFdhgPsPDKtjauo/r0jqHXbEqe34VqUm+osqp5CiLO9xngR0baFZ1Jrg6Oy51XMkjT1bt7D+DzbUO/BFD0Is9ORqi0+Q/OzD7owKv2ZYYFlPiWS6fI5kileYp6nKYeb9nPmub/N/HxYcDpmUcANI/ZkVnq8K+RF+5Vte0Jv/DECXbFy0YF5r5t8kNVtFki4q0Ljnna01LxOzRvnkZV0/KwScPqOh3yCf+HvT0Q+ThvU9zStfZZat7b7pzTHCTQEme2kxuYWTv0zwS2jS2uIhrojI0tUJXjd6+Lv+jNX+6wf1ie2QAp0DKMJy6ocpVRrEY/SVWGahLaGYQvoeIWbsd4Dv0cQu+rzmPPGLAEFuZORP8FB5V78knkOvynGvdZN7FzE9FLZ0YR3mEMCv+E8u3M0LL2CrJK+lKj8ulMhl/LsvUBEY9FOd194eiyMbwnqlZ9F+NA2LGTFUtS0/jmq/0Alsdm+Or2RqOi8bMhPq112uVc4L1wnJJXo0hiSoVYegBuJaJTm53/lMh7I7UEdhUYldnyACUC3LC+X5Gq6n7JuqVJPJIrcpPn5sOCUFRF+iw4BGOpDmJmvykC/yByDejZuYHoDNyEJLWyhpXxswj3X8ZikjZYfz4RESe3R2My08zenmjZS84YZOwy1M1ugKvZ8xl/EvegppFpaqP79Y53+uQI5Ohz9fUJs/XXmOVgPe3dmIf4qAVenDmcxhBHUJPM3F3+XEKiLjaqhrmfqBudyWS0X6PJzjoDEYdBwQxz9BJq/5KMzxEA4uwsluPMfxueLsDvhePIUv4hQV6xcpJBgWadx1Pq4cJMoGx2YS1OhuPq3Ouf0JHpkxeNUPPB3Tv98qUA1gZor/yKRrc4x1FXMTNX3Q8i0VBnMf9IsLanHC+7m4e/ErIutEW5LJ0kF01WbSxu9GTFMDoPg/i4kJNyT5/p8vcpNfBDzHH9nLvL+R2DynIHYtEGf5QLeiD+iQ9lO4hVjqXzsOio/cB1ZsXL/lfstixLdTyArblss8rqAgZ0J9zsbjqHmtjr7MOAkGFXKcR/Dzfhnp5iKDZ2YPbo/Eu52I0k/hidliYtM9tkCcqDnogwjSEoZ4Q6JhB9VQre/T9d7DSokOKjJ/WHG58cKlGItgcu70BmE+zEOyWZB6wcsY1TsqA3PFfgddpZjxjuNow6jnierqMf2w6lGS5JUC1G8rJpKR/6DrHi74iXlUv8RYzNZAxEdETiGOmplA7lIlxbpZmGrXd7PPfx9FXPXuUiouN8P9mFICP6vi4zfF5kdw9JM1VSc06E3ajMf0VTsWiPgXVK/yc0CnaOyuVYo6erOPLr4uegOwQvOO6U8YZf7kAUdFLsj9PAyjMg/kbE+E0IatzG9eF74XFNXQelmTMZzuh0r0ZlK95xJpSOUscQuOsDtm2rAkagcT6UjnyPLaudoVRs7R994Hm6QbIaia6hjTOnQ1gA1vk9FDZ1uT9M6ZLp6qR3k1vMuZLRsHISMWI7EoxMljJ1qC0ol8l1Xvcs8gHxUoIxuksC5cnE8FiATUR/6a41zbBJq+3gIPD8Suue90WntFwLn+hixOl3Ujv5rzDHcAdd7odEDk/676LM9DjH6SiiW9YYn5WKElbieD7fM8zhHfYx3Zee7bSW7U4dR8yhZdQxZyS7bd7hhkGpSxvpAKh01m6xEu531tdkuehe8LK10p2uoi5nGaJWPrcvSdMBOYDpDsaoZq/B8Paez4TYq0RU62RuLkjsQG8mZNqnBqYwJ04te78NCHoUeONcURjmZEyMhYvB0llLXudg1eEGVk70lNK6TEIe1V3/KTwky52cLhQ+a8B7qxuFPgguSg5o4rxa4lqBRC7/nILjhxovVBbHfIHI0Znqoh1f3X6VXv5b+D1ZRT+qw9yyKV4zcbigDDYLasN1YdxlHpXv9Iztm3YzcCLfvZw1c+6INjnTVkHoh5qSbAToXOx2/yiNGITv0MOZ57sBK1etaby4EVXTYgqS3Vzx+9hDsIDMznmvRJesmgXu9P9xtuuGDq9Ev2A1xGNhTmGPO5EXsducyvBUW1PguRJmSk1DJJjx7XuQbL8DzJsUauO6mIpSQayq04DI/BVKJkrHuv+KcOpntg7Bg4GTxN6Kl62sCZXBusTBRc9pLTsA7oPO+tcDD8wLvMvLykIvF3KN4X3Yu1Kyi7tRh5FyKVwzf7nrOYBLyPG4LwHT3xtjvbjO2BFHzpldp67vt8iaHwyOYr73rJZhzRdE11BOY3UzuZ7SWzEVf7AYuZ4hmpHkaijZexRmSqAfWba6+EC+Zl76lR8NIO7m734MLc5bmTvUoTPi6yVIr4WXwssocj1gct1NPJi24B9PgSlzqYkIoxXM1Eh6Fo1w+W6/ib93qlw+DC52rUpbNFryrc5D7UINdQhI7sKG41wfDnSrJMpxbR7Ajibj/8czxpBCfjjNlWr3yEGOOG45FMUeL4UXMC36qGx6Cha/dfW1BfPfqXe+YRaVD7qFEr9N2rJnaLpfPhYErgav5OjslMQF6IfHyCiwAlS36wc4cke1X0kp1b+5FrVvbrbOOwTPplLz3MFTMxBcZugVZfCAAAApnSURBVA/uJUju0OU6YVWgaqyOTmdmW6eZB5ebTp33cLjKdROuZsNN5PYFOxmJOm6auc9CjOgfLtW7DsI9nczsFX0BYqdemS4g3+fEcvxOi5FgtAETugVD3BPlh0ORQKez8FI7gx972MH/VdiL4EQLs2LDDfXwOszU/PzljESeKHCVpvCOCtE8Q0RHMK+hBvPIv328F0VwzWfXQ9fCELbJSygZ8gAV9Tljh6t7F3F4uq7MCsWuw25XLXhyiSS5ZTgkhk/MCgulEBq7Mf0frBhRa9Naqp9/LLXUtusfcwmag2SHjf8DuVFftEF0DfW9DNGQZqxoOBq7CRgmVaJwGpoESIlcvApZOl094hMx4epOhPd5uLc/hDHw6tL7BG65t7Db2YzfpRxJd8OgozyY2WKPsLI/VrO70wC8ALqJgF5owT2wsJuT2H01Y6HjNjluPHbV/tem+M8Vmdm9HhkDDwBncRg2R2m6nlX/gQeExn4eFvF+8k3kRKTfl3WYv9os0EqGTKOiPmdlG+kKhHu+m2N8Kp/pZVRUvAIPUb52uBbmxF7I05mExbaTt6oBdmTGzhPEiVKNn1Pdu0dSa10baYcY8gAuzPhvn8IL6luTKd3J6FVGBx212vqZx/KsOG58FYzHSLzM0m0N58LdrVtGQvAWeCnlyuYnmas7B2L4u98wvicIalEi9RrjuybDVR2k21KS9TDAbluWPs6U6YwCN8NQ69AFizvdZLgo0IJyKsd2TA4UwRhxm42k+VkAc0QJSl8nImH0+9mqbyVD76Oi3pOzjXQ1kjEd1cls2IzNRTpstRahPAs2ojtiz0OQpzTUg0z2RoQKdo1dGev6NVT7eruwdDGM+kTYikkaCcee0NH6rmTucMqxC4waT2OHyjHSxOzV2+RiQk8iKevHjO8JiquZRpqwkj7Ep5yGIFCZ57cjlOIm81m5AQ/1qbwuCP7CyLCOISRWyEaaYER0kjcPDEAKVpptKB+rg7t/Z9ltsufZlOh2FCV7nJRtpMfCre1Vi6MLdsjS1SyEZMr74b7ekR/UohLfOlOy6nvUtO7BzL9tQCWC2lnf5beRJs3yrEEC7tCocTtcH1wjXcSUVa3Lk0BRhFhvIRjpuyHXyiWdtcttrxkmE1AL7MalPb8Am4qkuQN1vPlck058G+7aQmehprLgGIEk2EykO2c58TJCPDuNdNFu51Hp8HsoWXVSdmb3SdgUcQWz/GAEEtp2JYtZpVQ6/AFK9my3T1iK/KB2/a39QMdQ7+4ycakQ2ISV0UVCdbt9GNnehKxopyb2/RD7Pptx/qB4CslAUtSgxCeKrT/d0teD1OOtQqIvQdGKrnIcycV0WQ639W4U+Egz25qzyM9mG0OPQYedi7Nkr/OpZOiftwuYZO2kL0VyWJS9RcdDAW4HKaJUq0Ulw6ZRsurM7L/VybvRQsdQD/yKJLu8idiCZO1qXxd1drlYnGOi+xaOqPMsQgjSNfLLsOOSEgYJigbspid7ULdrhtHjhg2C4Avsgjk63MXYyfQugOt1g25SkaRm92JmpzItkj1/QKXDpu7YRe8qUipBpvQtPggP+cHFbZLFUjuWoiXD76dkjzNCGZCuoS5k6rFyP9KH0oV+TNdVrh3jA0wZxiCYjvIi3Yz5fCzBYoXb0zgo3kT27681XKGfIxzD7mXrI+8gpnc38ysuxnm+CjRr1o2ThmZDLp4O0PW9neRuF1Dp8LuypUC7YV64LMixCHBzm2cSxrp0xP2U7Klb8KSPV0NdIdALNkxeQpu8S7ETkIa7iMmlZKXGez4SNkTl6QTYCtnCswLo+rUSJSFc4+Ana7DDPNxDxzU7lmHh87z3j/pKerE7QUNBL5txBdiWNBerUVKkg4TeO0EXQCI/xDXJXudRydA7dhjpXTvpEYjhnhTkWIQowT3cJZW90w1+LyWrvKoE8/AaD+pWoIZ6MVwvD3tsruGFOErHOLgpWbsJWYa/RDZ02LyNLN8gjUkN3Ouv4z5ExWXaCo2BqQJ9tdOsgCLab7BQC5t5iOFJyFN2QuasdJllmKxiGOq5eLa592MKNzG2qN/VFC8bSimXUj3Jnt/bUZS2y0j3QcXGSM44QmYASsgmIp8pY2d93/b/0bRueiAj9Fqb+jVMjoVS0/oJ0uen7bzR/tEZYhWjNb9hM2Q23b7kZdjBXhpSOOJzZKDfEvIOvz/q1k9kqMFx2YyFys0+x9BPgpHcI5jLasN8LHafFGzBOjUiiw9JnmDuIB9DNrEuv5VoQFI2+i1KdBudnbHtiM3flSAB9PfCmexh8Biy2nc59ZUvujVFrQ0rtYZT94a3lv5ed9TVBWCkGxDDfNrnHXQ2HZk76o896EITXMy3IxP8+0i0OoDx/W5Zgnv7ZyyEwmY5Fiz3YdI/VqjNoxsWYmf5AOK1fvM4nu1LEL/227vVikYEf4eWvGSP9FMZ6oZRhptpPQV1xjoZ4DdA5IRNqmXL9oxtRuvJbVBFW4wFGdfbGCanYN7btQBSb4ZlUaxUShAzN14NNbfPsp/Mh1rMHLiGdWs5denN3NEt0lxUbIA7fBoaK0xCiYFkrXsKnpSHMXH7JpXH4CUcY+CqOg2lhNJsgjziM7gnXtWnuGzAZPwgfufJPtSkLse79AwSLqUbO1RDx1uy4UoUaPWgQOfEEjy70+F6dcMaGJH7I3hP/hfNLG4scMW9y/Hb7vJ1p4Jrz+l1dzxHoHUkl0a4WjfDYMyB8VgaQCJTLriNSn4u1KTfgnJc2mDtD3Wszi4XEo1YMGzCpDEbJVfLgqwbFKACYYhvYAHTC4sXL264GiTxrYNRnoVM7o2MVpnSlEPH+ATkLPSEeqBbI1iH61mJa3wG3gG/whmdsdDRlSCOOmOElKoGIS9hgkNXsxTyF57CvCO6YOyw91xKVI7n7KiziWNR+dMCTkj+Epng7GqhLS95M71eDfVNKEEKss33NhiIL7FyXAWX6yK4uaPC6TAKOvfGgnvIL/WtfpA27QeD1Qk1m3F4Hhrh1lyPrNUVSGwrJMOcj37Q/q2G9yNttItxH5rxrNVi17oKi79FeO4KhUHYYVdn/NZlkJ5N4RrTxnk1rvH9AK9xDJT1WgKeR/wm3YP6SuFFztdQPTAQIZ1G5IfMxwZlrR/X5YOhTtMX5Xin+dDS1SvLkHOxGElv+2Bxn6vW+2Nogi/V+8od+G2oDQaDgUOCoV5mCAgfDXWa4djcnAOPX1BkhvFeyMqz6YZEzb2hJ+6kuT8PJaLaJb7GUBsMBoOBRQCGOk1nJMKeCo+XpIxqmvUIDcxB8u1CF97YGDwY+yLGfhAqTNLKkw/Ala+FV0P9VdDVNRgMBkNh8gUSYachbHMo3NDDYLi9aiQ0I9/iEyR/fQgpVa+6Bq0IYczBQfACHIi8n9VB3m1jqA0Gg8EQBT7JcEV3zEiMrMJutktWQmgj8i02IefiM8TvN2EXLZ1cvADHveZpMRgMBoPBYDAYDAaDwWAwGAwGg8FgMBgMBoPBYDAYDAaDwWAwGAwGg8FgMBgMBoPBYDAYDAaDwWAwGAwGg8FgMBgMAUNE/wcN9iMzoi+OcAAAAABJRU5ErkJggg=='
        ];

        return $view->make($viewPath)->with($data);
    }

    private function preRequireSite()
    {
        $problems = collect();
        $defaultPhpVersion = '7.2.0';
        $phpversion = version_compare(PHP_VERSION, $defaultPhpVersion, '>=');
        if (!$phpversion) {
            $problems->push(['message' => 'PHP 版本必须大于'.$defaultPhpVersion]);
        }

        $extension = collect([
            'dom',
            'gd',
            'json',
            'mbstring',
            'openssl',
            'pdo_mysql',
            'fileinfo'
        ])->reject(function ($extension) {
            return extension_loaded($extension);
        })->map(function ($extension) {
            return [
                'message' => "PHP扩展 '$extension' 未安装.",
            ];
        });

        $problems = $problems->merge($extension);

        $storageDirWritable = is_writable(base_path('storage'));
        $cacheDirWritable = is_writable(storage_path('cache'));
        $configDirWritable = is_writable($this->app->configPath());

        if (!$storageDirWritable) {
            $problems->push(['message' => 'storage 目录不可写']);
        }

        if (!$cacheDirWritable) {
            $problems->push(['message' => 'storage/cache 目录不可写']);
        }

        if (!$configDirWritable) {
            $problems->push(['message' => 'config 目录不可写']);
        }

        if ($this->app->isInstall()) {
            $url = $this->app->make(UrlGenerator::class);
            $setting = $this->app->make(SettingsRepository::class);
            $problems->push(['message' => '您已安装过站点，请直接访问 <a href="'.$url->to('/').'">'.$setting->get('site_name').'</a>']);
        }

        return $problems;
    }
}
