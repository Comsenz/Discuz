(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{DvCQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(a("QbLZ"));a("cajz");var s=i(a("MW2h"));function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,n.default)({name:"cont-manage-view"},s.default)},MW2h:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(a("4gYi")),s=o(a("Dt3C")),i=o(a("wd/R")),l=o(a("VVfg")),r=a("L2JU");function o(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{operatingList:[{name:"批量移动到分类",label:"class"},{name:"批量置顶",label:"sticky"},{name:"批量删除",label:"delete"},{name:"批量设置精华",label:"marrow"}],operatingSelect:"",categoriesList:[],categoryId:"",toppingRadio:2,essenceRadio:2,checkAll:!1,checkAllNum:0,themeListAll:[],checkedTheme:[],isIndeterminate:!1,themeList:[],currentPag:1,total:0,pageCount:1}},computed:(0,r.mapState)({searchData:function(e){return e.admin.searchData}}),methods:{handleCheckAllChange:function(e){console.log(this.themeListAll),console.log(e),this.checkedTheme=e?this.themeListAll:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e,t,a){var n=this.checkedTheme.length;this.checkAll=n===this.themeListAll.length,this.isIndeterminate=n>0&&n<this.themeListAll.length},formatDate:function(e){return(0,i.default)(e).format("YYYY-MM-DD HH:mm")},submitClick:function(){var e=this,t=[],a={},n={category:{data:{id:""}}},s=!1;switch(this.operatingSelect){case"class":this.categoryId?n.category.data.id=this.categoryId:s=!0;break;case"sticky":a.isSticky=1===this.toppingRadio;break;case"delete":a.isDeleted=!0;break;case"marrow":a.isEssence=1===this.essenceRadio;break;default:s=!0,console.log("操作选项错误，请重新选择或刷新页面(F5)"),this.$message({showClose:!0,message:"操作选项错误，请重新选择或刷新页面(F5)",type:"warning"})}"class"===this.operatingSelect?this.checkedTheme.forEach((function(e,s){t.push({type:"threads",id:e,attributes:a,relationships:n})})):this.checkedTheme.forEach((function(e,n){t.push({type:"threads",id:e,attributes:a})})),t.length<1?this.$message({showClose:!0,message:"主题列表为空，请选择主题",type:"warning"}):s||this.appFetch({url:"threads/batch",method:"patch",data:{data:t}}).then((function(t){t.meta&&t.data?(e.checkedTheme=[],e.$message.error("操作失败！")):(e.pageCount<3&&(e.currentPag=1,l.default.setLItem("currentPag",1)),e.getThemeList(Number(l.default.getLItem("currentPag"))||1),e.isIndeterminate=!1,e.checkAll=!1,e.checkedTheme=[],e.$message({message:"操作成功",type:"success"}))})).catch((function(e){console.log(e)}))},handleSizeChange:function(e){console.log("每页 "+e+" 条")},handleCurrentChange:function(e){l.default.setLItem("currentPag",e),this.isIndeterminate=!1,this.checkAll=!1,this.getThemeList(e)},getThemeList:function(e){var t=this,a=this.searchData;this.appFetch({url:"threads",method:"get",data:{"filter[isDeleted]":"no","filter[isApproved]":"1","filter[username]":a.themeAuthor,"filter[categoryId]":a.categoryId,"page[number]":e,"page[size]":a.pageSelect,"filter[q]":a.themeKeyWords,"filter[createdAtBegin]":a.dataValue[0],"filter[createdAtEnd]":a.dataValue[1],"filter[viewCountGt]":a.viewedTimesMin,"filter[viewCountLt]":a.viewedTimesMax,"filter[postCountGt]":a.numberOfRepliesMin,"filter[postCountLt]":a.numberOfRepliesMax,"filter[isEssence]":a.essentialTheme,"filter[isSticky]":a.topType}}).then((function(e){console.log(e),t.themeList=e.readdata,t.total=e.meta.threadCount,t.pageCount=e.meta.pageCount,t.themeListAll=[],t.themeList.forEach((function(e,a){t.themeListAll.push(e._data.id)})),console.log("完车给")})).catch((function(e){console.log(e)}))},getCategories:function(){var e=this;this.appFetch({url:"categories",method:"get",data:{}}).then((function(t){t.data.forEach((function(t,a){e.categoriesList.push({name:t.attributes.name,id:t.id})}))})).catch((function(e){console.log(e)}))}},beforeUpdate:function(){l.default.setLItem("currentPag",this.currentPag)},beforeDestroy:function(){l.default.setLItem("currentPag",1)},created:function(){this.currentPag=Number(l.default.getLItem("currentPag"))||1,this.getThemeList(Number(l.default.getLItem("currentPag"))||1),this.getCategories()},components:{Card:n.default,ContArrange:s.default}}},WONP:function(e,t,a){"use strict";a.r(t);var n=a("nUhg"),s=a("fthR");for(var i in s)"default"!==i&&function(e){a.d(t,e,(function(){return s[e]}))}(i);var l=a("KHd+"),r=Object(l.a)(s.default,n.a,n.b,!1,null,null,null);t.default=r.exports},fthR:function(e,t,a){"use strict";a.r(t);var n=a("DvCQ"),s=a.n(n);for(var i in n)"default"!==i&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t.default=s.a},nUhg:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cont-manage-box"},[a("div",{staticClass:"cont-manage-theme"},[a("div",{staticClass:"cont-manage-theme__table"},[a("div",{staticClass:"cont-manage-theme__table-header"},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}}),e._v(" "),a("p",{staticClass:"cont-manage-theme__table-header__title"},[e._v("主题列表")])],1),e._v(" "),e._l(e.themeList,(function(t,n){return a("ContArrange",{key:t._data.id,attrs:{author:t.user?t.user._data.username:"该用户被删除",theme:t.category._data.name,prply:t._data.postCount,browse:t._data.viewCount,last:t.lastPostedUser?t.lastPostedUser._data.username:"该用户被删除",finalPost:e.formatDate(t._data.createdAt)}},[a("div",{staticClass:"cont-manage-theme__table-side",attrs:{slot:"side"},slot:"side"},[a("el-checkbox",{attrs:{label:t._data.id},on:{change:function(t){return e.handleCheckedCitiesChange()}},model:{value:e.checkedTheme,callback:function(t){e.checkedTheme=t},expression:"checkedTheme"}})],1),e._v(" "),a("div",{staticStyle:{"line-height":"20PX"},attrs:{slot:"main"},slot:"main"},[e._v("\n          "+e._s(t.firstPost._data.content)+"\n        ")])])})),e._v(" "),e.themeList.length<1?a("div",{staticClass:"cont-manage-theme__table-no-data"},[a("p",[e._v("暂无数据")])]):e._e(),e._v(" "),e.pageCount>1?a("div",{staticClass:"cont-manage-theme__table-footer"},[a("el-pagination",{attrs:{"current-page":e.currentPag,"page-size":parseInt(e.searchData.pageSelect),layout:"total, prev, pager, next,jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPag=t},"update:current-page":function(t){e.currentPag=t}}})],1):e._e()],2)]),e._v(" "),a("div",{staticClass:"cont-manage-operating"},[a("p",[e._v("操作")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.operatingList,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{"label-class-name":"cont-manage-operating__table-label",label:"操作",prop:"theme",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.label},model:{value:e.operatingSelect,callback:function(t){e.operatingSelect=t},expression:"operatingSelect"}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"选项","min-width":"250"},scopedSlots:e._u([{key:"default",fn:function(t){return["批量移动到分类"===t.row.name?a("el-select",{attrs:{placeholder:"选择分类"},model:{value:e.categoryId,callback:function(t){e.categoryId=t},expression:"categoryId"}},e._l(e.categoriesList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1):e._e(),e._v(" "),"批量置顶"===t.row.name?a("el-radio-group",{staticClass:"cont-manage__option-select",model:{value:e.toppingRadio,callback:function(t){e.toppingRadio=t},expression:"toppingRadio"}},[a("el-radio",{attrs:{label:1}},[e._v("置顶")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("解除置顶")])],1):e._e(),e._v(" "),"批量设置精华"===t.row.name?a("el-radio-group",{staticClass:"cont-manage__option-select",model:{value:e.essenceRadio,callback:function(t){e.essenceRadio=t},expression:"essenceRadio"}},[a("el-radio",{attrs:{label:1}},[e._v("精华")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("取消精华")])],1):e._e()]}}])})],1),e._v(" "),a("Card",{staticClass:"footer-btn"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitClick}},[e._v("提交")])],1)],1)])},s=[];a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s}))}}]);