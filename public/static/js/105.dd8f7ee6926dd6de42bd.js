(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{"1iK8":function(e,a,t){"use strict";t.r(a);var s=t("o2sI"),r=t("NY7+");for(var n in r)"default"!==n&&function(e){t.d(a,e,(function(){return r[e]}))}(n);var o=t("Yj/X"),i=Object(o.a)(r.default,s.a,s.b,!1,null,null,null);a.default=i.exports},"NY7+":function(e,a,t){"use strict";t.r(a);var s=t("bOA3"),r=t.n(s);for(var n in s)"default"!==n&&function(e){t.d(a,e,(function(){return s[e]}))}(n);a.default=r.a},bOA3:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=n(t("bS4n"));t("I1+7");var r=n(t("lgPP"));function n(e){return e&&e.__esModule?e:{default:e}}a.default=(0,s.default)({name:"user-details-view"},r.default)},lgPP:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=l(t("cLjf")),r=l(t("hDQ3")),n=l(t("4gYi")),o=l(t("pNQN")),i=l(t("VVfg"));function l(e){return e&&e.__esModule?e:{default:e}}a.default={data:function(){return{fileList:[],options:[],optionsList:[],imageUrl:"",userRole:[],userInfo:{},newPassword:"",wechatNickName:"",sex:"",disabled:!1,disabledReason:!1,reasonsForDisable:"",optionsStatus:[{value:0,label:"正常"},{value:1,label:"禁用"},{value:2,label:"审核"}],value:"",query:{}}},created:function(){this.query=this.$route.query,this.getUserDetail(),this.getUserList()},methods:{getUserDetail:function(){var e=this;return(0,r.default)(s.default.mark((function a(){var t,r;return s.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t=i.default.getLItem("tokenId"),a.next=4,e.appFetch({method:"get",url:"users",splice:"/"+e.query.id,data:{include:"wechat,groups"}});case 4:(r=a.sent).errors?e.$message.error(r.errors[0].code):(e.userInfo=r.readdata._data,e.imageUrl=e.userInfo.avatarUrl,e.reasonsForDisable=e.userInfo.banReason,e.userRole=r.readdata.groups.map((function(e){return e._data.id})),r.readdata.wechat&&(e.wechatNickName=r.readdata.wechat._data.nickname,e.sex=r.readdata.wechat._data.sex),t==e.userInfo.id&&(e.disabled=!0),1==e.userInfo.status&&(e.disabledReason=!0)),a.next=10;break;case 8:a.prev=8,a.t0=a.catch(0);case 10:case"end":return a.stop()}}),a,e,[[0,8]])})))()},handleRemove:function(e,a){},deleteImage:function(){var e=this;this.imageUrl="",this.appFetch({url:"deleteAvatar",method:"delete",splice:"/"+this.query.id+"/avatar",data:{}}).then((function(a){a.errors?e.$message.error(a.errors[0].code):e.$message.success("删除成功")}))},handlePreview:function(e){},handleExceed:function(e,a){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+a.length)+" 个文件")},beforeRemove:function(e,a){return this.MessageBox.confirm("确定移除 "+e.name+"？")},handleAvatarSuccess:function(e,a){},handleFile:function(){},beforeAvatarUpload:function(e){var a="image/jpeg"===e.type,t=e.size/1024/1024<2;return a||this.$message.error("上传头像图片只能是 JPG 格式!"),t||this.$message.error("上传头像图片大小不能超过 2MB!"),a&&t},uploaderLogo:function(e){var a=this,t=new FormData;t.append("avatar",e.file),this.appFetch({url:"upload",method:"post",splice:this.query.id+"/avatar",data:t}).then((function(e){e.errors?a.$message.error(e.errors[0].code):(a.$message.success("上传成功"),a.imageUrl=e.readdata._data.avatarUrl)}))},submission:function(){var e=this,a=this.userInfo.originalMobile;if(""==a);else if(!/^((13|14|15|17|18)[0-9]{1}\d{8})$/.test(a))return this.$toast("您输入的手机号码不合法，请重新输入");this.appFetch({url:"users",method:"patch",splice:"/"+this.query.id,data:{data:{attributes:{newPassword:this.newPassword,mobile:a,groupId:this.userRole,status:this.userInfo.status,refuse_message:this.reasonsForDisable}}}}).then((function(a){a.errors?a.errors[0].detail?e.$message.error(a.errors[0].code+"\n"+a.errors[0].detail[0]):e.$message.error(a.errors[0].code):e.$message({message:"提交成功",type:"success"})}))},getUserList:function(){var e=this;return(0,r.default)(s.default.mark((function a(){var t,r;return s.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,e.appFetch({method:"get",url:"groups"});case 3:t=a.sent,r=t.data,e.options=r.map((function(e){return{value:e.id,label:e.attributes.name}})),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0);case 11:case"end":return a.stop()}}),a,e,[[0,8]])})))()},userStatusChange:function(e){this.disabledReason=1==e,1!=e&&(this.reasonsForDisable="")}},components:{Card:n.default,CardRow:o.default}}},o2sI:function(e,a,t){"use strict";t.d(a,"a",(function(){return s})),t.d(a,"b",(function(){return r}));var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"user-details-box"},[t("div",{staticClass:"details-wallet-header"},[t("p",{staticClass:"details-wallet-header__name"},[e._v(e._s(this.userInfo.username)+"（UID："+e._s(this.userInfo.id)+"）")]),e._v(" "),t("i",{staticClass:"details-wallet-header__i"}),e._v(" "),t("span",{staticClass:"details-wallet-header__details"},[e._v("详情")]),e._v(" "),t("span",{on:{click:function(a){return e.$router.push({path:"/admin/wallet",query:e.query})}}},[e._v("钱包")])]),e._v(" "),t("Card",[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","http-request":e.uploaderLogo,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},on:{change:e.handleFile}},[e.imageUrl?t("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:e.deleteImage}},[e._v("删除")])],1),e._v(" "),t("Card",{attrs:{header:"新密码："}},[t("CardRow",{attrs:{description:"如果不更改密码此处请留空"}},[t("el-input",{attrs:{clearable:"",disabled:e.disabled},model:{value:e.newPassword,callback:function(a){e.newPassword=a},expression:"newPassword"}})],1)],1),e._v(" "),t("Card",{attrs:{header:"手机号："}},[t("CardRow",[t("el-input",{model:{value:e.userInfo.originalMobile,callback:function(a){e.$set(e.userInfo,"originalMobile",a)},expression:"userInfo.originalMobile"}})],1)],1),e._v(" "),t("Card",{attrs:{header:"用户角色："}},[t("CardRow",{attrs:{description:"设置允许参与搜索的用户组，可多选"}},[t("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.userRole,callback:function(a){e.userRole=a},expression:"userRole"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{disabled:"6"===e.value||"7"===e.value,label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),t("Card",{attrs:{header:"状态："}},[t("CardRow",[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(a){return e.userStatusChange(e.userInfo.status)}},model:{value:e.userInfo.status,callback:function(a){e.$set(e.userInfo,"status",a)},expression:"userInfo.status"}},e._l(e.optionsStatus,(function(e){return t("el-option",{key:e.value,attrs:{disabled:2===e.value,label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),t("Card",{directives:[{name:"show",rawName:"v-show",value:e.disabledReason,expression:"disabledReason"}],attrs:{header:"禁用原因："}},[t("CardRow",[t("el-input",{attrs:{clearable:""},model:{value:e.reasonsForDisable,callback:function(a){e.reasonsForDisable=a},expression:"reasonsForDisable"}})],1)],1),e._v(" "),t("Card",{attrs:{header:"注册时间："}},[t("p",[e._v(e._s(e.$moment(e.userInfo.createdAt).format("YYYY-MM-DD HH:mm")))])]),e._v(" "),t("Card",{attrs:{header:"注册IP："}},[t("p",[e._v(e._s(e.userInfo.registerIp))])]),e._v(" "),e.userInfo.loginAt?t("Card",{attrs:{header:"最后登录时间："}},[t("p",[e._v(e._s(e.$moment(e.userInfo.loginAt).format("YYYY-MM-DD HH:mm")))])]):e._e(),e._v(" "),t("Card",{attrs:{header:"最后登录IP："}},[t("p",[e._v(e._s(e.userInfo.lastLoginIp))])]),e._v(" "),e.wechatNickName?t("Card",{attrs:{header:"微信昵称："}},[t("p",[e._v(e._s(e.wechatNickName))])]):e._e(),e._v(" "),e.sex?t("Card",{attrs:{header:"性别："}},[t("p",[e._v(e._s(0===e.sex?"未知":1===e.sex?"男":"女"))])]):e._e(),e._v(" "),t("Card",{staticClass:"footer-btn"},[t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.submission}},[e._v("提交")])],1)],1)},r=[]}}]);